<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPO GMP Tracker</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css"> <!-- Link to the CSS file -->
</head>
<body>

<!-- Hero Section -->
<div class="hero">
    <h2>Track Upcoming IPOs and Their GMP</h2>
</div>

<!-- Table Container -->
<div class="container">
    <table id="ipo-table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">IPO Name</th>
            <th onclick="sortTable(1)">Price (₹)</th>
            <th onclick="sortTable(2)">GMP (₹)</th>
            <th onclick="sortTable(3)">Est. Listing</th>
            <th onclick="sortTable(4)">IPO Size (Cr)</th>
            <th onclick="sortTable(5)">Lot Size</th>
            <th onclick="sortTable(6)">Open Date</th>
            <th onclick="sortTable(7)">Close Date</th>
            <th onclick="sortTable(8)">Listing Date</th>
            <th onclick="sortTable(9)">GMP Updated Date</th>
        </tr>
        </thead>
        <tbody id="ipo-container">
        <!-- IPO data will be dynamically inserted here -->
        </tbody>
    </table>
    <div class="no-data" id="no-data-message">Loading GMP data...</div>
</div>

<!-- Footer -->
<footer>
    © 2024 IPO GMP Tracker | Powered by Atul Bhoyar Inc
</footer>

<script>
    async function fetchGMPData() {
        try {
            const response = await fetch('/api/gmp'); // API endpoint
            const data = await response.json();

            const tableBody = document.getElementById('ipo-container');
            const noDataMessage = document.getElementById('no-data-message');
            tableBody.innerHTML = '';  // Clear previous data

            if (data.length > 0) {
                data.forEach(ipo => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                            <td>${ipo.ipo}</td>
                            <td>${ipo.price}</td>
                            <td>${ipo.gmp}</td>
                            <td>${ipo.estListing}</td>
                            <td>${ipo.ipoSize}</td>
                            <td>${ipo.lot}</td>
                            <td>${ipo.open}</td>
                            <td>${ipo.close}</td>
                            <td>${ipo.listing}</td>
                            <td>${ipo.gmpUpdated}</td>
                        `;
                    tableBody.appendChild(row);
                });
                noDataMessage.style.display = 'none';
            } else {
                noDataMessage.innerText = 'No IPO data available.';
            }
        } catch (error) {
            console.error('Error fetching GMP data:', error);
            document.getElementById('no-data-message').innerHTML = '<p>Error fetching data. Please try again later.</p>';
        }
    }

    function sortTable(columnIndex) {
        const table = document.getElementById("ipo-table");
        let switching = true;
        let dir = "asc"; // Set the sorting direction to ascending
        let rows, i, x, y, shouldSwitch;

        while (switching) {
            switching = false;
            rows = table.rows;

            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("TD")[columnIndex];
                y = rows[i + 1].getElementsByTagName("TD")[columnIndex];

                // Compare values for sorting
                if (dir === "asc") {
                    if (parseFloat(x.innerText.replace(/₹|,/g, '')) > parseFloat(y.innerText.replace(/₹|,/g, ''))) {
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir === "desc") {
                    if (parseFloat(x.innerText.replace(/₹|,/g, '')) < parseFloat(y.innerText.replace(/₹|,/g, ''))) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }

            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            } else {
                if (dir === "asc") {
                    dir = "desc"; // Change the direction to descending
                } else {
                    dir = "asc"; // Change the direction back to ascending
                }
            }
        }
    }

    // Fetch GMP data on page load
    fetchGMPData();
</script>
</body>
</html>
